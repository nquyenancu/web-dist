System.register(["./index-legacy-137abe7a.js","./item_type-legacy-401bb746.js","./ResponsiveGrid-legacy-12772831.js"],(function(e,r){"use strict";var t,n,a,i,d,u,g,o,l,c,s,m,h,v,p,y,b,f,$,w,C,_,x,O,S,T,k,j,I,N,B,q,R,J,V,D,E,F,G,P,Q,U;return{setters:[e=>{t=e.d,n=e.j,a=e.a_,i=e.a0,d=e.ao,u=e.a1,g=e.I,o=e.bO,l=e.T,c=e.bP,s=e.bQ,m=e.bR,h=e.bS,v=e.bT,p=e.bU,y=e.bV,b=e.E,f=e.bW,$=e.bX,w=e.bY,C=e.y,_=e.F,x=e.b0,O=e.u,S=e.a,T=e.b4,k=e.r,j=e.bu,I=e.C,N=e.bd,B=e.a3,q=e.ci,R=e.b_,J=e.b$,V=e.m,D=e.B,E=e.n,F=e.N,G=e.bb,P=e.a6},e=>{Q=e.T},e=>{U=e.R}],execute:function(){const r=e=>{const r=t();return n(x,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[n(a,{get for(){return e.name},display:"flex",alignItems:"center",get children(){return r(e.full_name_path??"common"===e.driver?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),n(i,{get fallback(){return n(d,{get children(){return r("settings.unknown_type")}})},get children(){return[n(u,{get when(){return e.type===Q.String},get children(){return n(g,{get id(){return e.name},get type(){return"password"==e.name?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===Q.String?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),n(u,{get when(){return e.type===Q.Number},get children(){return n(g,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===Q.Number?r=>e.onChange?.(parseInt(r.currentTarget.value)):void 0}})}}),n(u,{get when(){return e.type===Q.Bool},get children(){return n(o,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===Q.Bool?r=>e.onChange?.(r.currentTarget.checked):void 0}})}}),n(u,{get when(){return e.type===Q.Text},get children(){return n(l,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===Q.Text?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),n(u,{get when(){return e.type===Q.Select},get children(){return n(c,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===Q.Select?r=>e.onChange?.(r):void 0},get children(){return[n(s,{get children(){return[n(m,{get children(){return r("global.choose")}}),n(h,{}),n(v,{})]}}),n(p,{get children(){return n(y,{get children(){return n(b,{get each(){return e.options?.split(",")},children:t=>n(f,{value:t,get children(){return[n($,{get children(){return r((e.options_prefix??("common"===e.driver?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`))+`.${t}`)}}),n(w,{})]}})})}})}})]}})}})]}}),n(C,{get when(){return e.help},get children(){return n(_,{get children(){return r("common"===e.driver?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function W(e,r){switch(e){case Q.Bool:return!!r&&"true"===r;case Q.Number:return r?parseInt(r):0;default:return r||""}}e("default",(()=>{const e=t(),{params:a,back:i,to:d}=O(),{id:u}=a,[g,o]=S((()=>T.get("/admin/driver/list")),!0),[l,c]=k({}),[s,m]=S((()=>T.get(`/admin/storage/get?id=${u}`)),!0),[h,v]=S((()=>T.get(`/admin/driver/info?driver=${p.driver}`)),!0);u?(async()=>{const e=await m();G(e,(async e=>{y(e),$(JSON.parse(e.addition));const r=await v();G(r,(e=>c({[p.driver]:e})))}))})():(async()=>{const e=await o();G(e,c)})();const[p,y]=j({}),[f,$]=j({}),[w,_]=S((()=>(y("addition",JSON.stringify(f)),T.post("/admin/storage/"+(u?"update":"create"),p)))),x=I((()=>{const e=l()[p.driver]?.config.alert;if(console.log(e),e)return e.split("|")[0]}));return n(P,{get loading(){return u?s()||h():g()},get children(){return[n(N,{mb:"$2",get children(){return e("global."+(u?"edit":"add"))}}),n(B,{mb:"$2",spacing:"$2",get children(){return[n(r,{name:"driver",default:"",readonly:void 0!==u,required:!0,get type(){return Q.Select},get options(){return u?p.driver:Object.keys(l()).join(",")},get value(){return p.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:e=>{for(const r of l()[e].common)y(r.name,W(r.type,r.default));$(q((e=>{for(const r in e)delete e[r]})));for(const r of l()[e].additional)$(r.name,W(r.type,r.default));y("driver",e)}}),n(C,{get when(){return x()},get children(){return n(R,{get status(){return x()},w:"$full",get children(){return[n(J,{}),I((()=>e(`drivers.config.${p.driver}.alert`)))]}})}})]}}),n(U,{get children(){return n(C,{get when(){return l()[p.driver]},get children(){return[n(b,{get each(){return l()[p.driver].common},children:e=>n(r,V(e,{driver:"common",get value(){return p[e.name]},onChange:r=>{y(e.name,r)}}))}),n(b,{get each(){return l()[p.driver].additional},children:e=>n(r,V(e,{get driver(){return p.driver},get value(){return f[e.name]},onChange:r=>{$(e.name,r)}}))})]}})}}),n(D,{mt:"$2",get loading(){return w()},onClick:async()=>{l()[p.driver].config.need_ms&&(E.info(e("manage.add_storage-tips")),window.open(F("/@manage/messenger"),"_blank"));const r=await _();G(r,(()=>{E.success(e("global.save_success")),i()}),((e,t)=>{r.data.id&&d(`/@manage/storages/edit/${r.data.id}`)}))},get children(){return e("global."+(u?"save":"add"))}})]}})}))}}}));
