import{d as R,j as t,a_ as P,a0 as G,ao as H,a1 as s,I as x,bO as J,T as Q,bP as U,bQ as W,bR as X,bS as Y,bT as z,bU as K,bV as Z,E as S,bW as p,bX as ee,bY as te,y as $,F as ne,b0 as re,u as ae,a as v,b4 as f,r as ie,bu as O,C as _,bd as de,a3 as ue,ci as ge,b_ as le,b$ as ce,m as k,B as oe,n as I,N as se,bb as y,a6 as me}from"./index.cc96c54e.js";import{T as g}from"./item_type.be442da4.js";import{R as he}from"./ResponsiveGrid.52d96e6d.js";const b=e=>{const d=R();return t(re,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(P,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var a;return d(((a=e.full_name_path)!=null?a:e.driver==="common")?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(G,{get fallback(){return t(H,{get children(){return d("settings.unknown_type")}})},get children(){return[t(s,{get when(){return e.type===g.String},get children(){return t(x,{get id(){return e.name},get type(){return e.name=="password"?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===g.String?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===g.Number},get children(){return t(x,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===g.Number?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,parseInt(a.currentTarget.value))}:void 0}})}}),t(s,{get when(){return e.type===g.Bool},get children(){return t(J,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===g.Bool?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a.currentTarget.checked)}:void 0}})}}),t(s,{get when(){return e.type===g.Text},get children(){return t(Q,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===g.Text?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a.currentTarget.value)}:void 0}})}}),t(s,{get when(){return e.type===g.Select},get children(){return t(U,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===g.Select?a=>{var i;return(i=e.onChange)==null?void 0:i.call(e,a)}:void 0},get children(){return[t(W,{get children(){return[t(X,{get children(){return d("global.choose")}}),t(Y,{}),t(z,{})]}}),t(K,{get children(){return t(Z,{get children(){return t(S,{get each(){var a;return(a=e.options)==null?void 0:a.split(",")},children:a=>t(p,{value:a,get children(){return[t(ee,{get children(){var i;return d(((i=e.options_prefix)!=null?i:e.driver==="common"?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`)+`.${a}`)}}),t(te,{})]}})})}})}})]}})}})]}}),t($,{get when(){return e.help},get children(){return t(ne,{get children(){return d(e.driver==="common"?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function L(e,d){switch(e){case g.Bool:return d?d==="true":!1;case g.Number:return d?parseInt(d):0;default:return d||""}}const Se=()=>{const e=R(),{params:d,back:a,to:i}=ae(),{id:l}=d,[B,F]=v(()=>f.get("/admin/driver/list"),!0),[c,w]=ie({}),N=async()=>{const n=await F();y(n,w)},[A,V]=v(()=>f.get(`/admin/storage/get?id=${l}`),!0),[j,D]=v(()=>f.get(`/admin/driver/info?driver=${u.driver}`),!0);l?(async()=>{const n=await V();y(n,async r=>{o(r),m(JSON.parse(r.addition));const h=await D();y(h,M=>w({[u.driver]:M}))})})():N();const[u,o]=O({}),[C,m]=O({}),[E,q]=v(()=>(o("addition",JSON.stringify(C)),f.post(`/admin/storage/${l?"update":"create"}`,u))),T=_(()=>{var r;const n=(r=c()[u.driver])==null?void 0:r.config.alert;if(console.log(n),n)return n.split("|")[0]});return t(me,{get loading(){return l?A()||j():B()},get children(){return[t(de,{mb:"$2",get children(){return e(`global.${l?"edit":"add"}`)}}),t(ue,{mb:"$2",spacing:"$2",get children(){return[t(b,{name:"driver",default:"",readonly:l!==void 0,required:!0,get type(){return g.Select},get options(){return l?u.driver:Object.keys(c()).join(",")},get value(){return u.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:n=>{for(const r of c()[n].common)o(r.name,L(r.type,r.default));m(ge(r=>{for(const h in r)delete r[h]}));for(const r of c()[n].additional)m(r.name,L(r.type,r.default));o("driver",n)}}),t($,{get when(){return T()},get children(){return t(le,{get status(){return T()},w:"$full",get children(){return[t(ce,{}),_(()=>e(`drivers.config.${u.driver}.alert`))]}})}})]}}),t(he,{get children(){return t($,{get when(){return c()[u.driver]},get children(){return[t(S,{get each(){return c()[u.driver].common},children:n=>t(b,k(n,{driver:"common",get value(){return u[n.name]},onChange:r=>{o(n.name,r)}}))}),t(S,{get each(){return c()[u.driver].additional},children:n=>t(b,k(n,{get driver(){return u.driver},get value(){return C[n.name]},onChange:r=>{m(n.name,r)}}))})]}})}}),t(oe,{mt:"$2",get loading(){return E()},onClick:async()=>{c()[u.driver].config.need_ms&&(I.info(e("manage.add_storage-tips")),window.open(se("/@manage/messenger"),"_blank"));const n=await q();y(n,()=>{I.success(e("global.save_success")),a()},(r,h)=>{n.data.id&&i(`/@manage/storages/edit/${n.data.id}`)})},get children(){return e(`global.${l?"save":"add"}`)}})]}})};export{Se as default};
