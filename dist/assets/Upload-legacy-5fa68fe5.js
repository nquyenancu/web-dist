System.register(["./index-legacy-137abe7a.js","./index-legacy-aff400bf.js"],(function(e,t){"use strict";var r,n,a,o,s,l,c,i,u,d,g,p,f,h,m,y,w,b,$,k,v,C,P,D,x,z,_,A,F;return{setters:[e=>{r=e.b4,n=e._,a=e.o,o=e.d,s=e.u,l=e.r,c=e.bu,i=e.j,u=e.y,d=e.a8,g=e.B,p=e.E,f=e.I,h=e.a3,m=e.ad,y=e.n,w=e.bd,b=e.a5,$=e.aP,k=e.ac,v=e.ba,C=e.bv,P=e.C,D=e.bw,x=e.bx,z=e.by,_=e.p},e=>{A=e.a,F=e.b}],execute:function(){const t={pending:"neutral",uploading:"info",backending:"info",success:"success",error:"danger"},R=async e=>{let t=[];const r=async(e,n)=>{const a=new Promise((a=>{const o=e=>{console.error(e),a({})};if(e.isFile)e.file((e=>{const r=new File([e],n+e.name,{type:e.type});t.push(r),console.log(r),a({})}),o);else if(e.isDirectory){const t=e.createReader(),s=()=>{t.readEntries((async t=>{0===t.length&&a({});for(let a=0;a<t.length;a++)await r(t[a],n+e.name+"/");s()}),o)};s()}}));await a};return await r(e,""),t},S=e=>({name:e.name,path:e.webkitRelativePath?e.webkitRelativePath:e.name,size:e.size,progress:0,speed:0,status:"pending"}),j=[{name:"Form",upload:async(e,t,a,o=!1)=>{let s=(new Date).valueOf(),l=0;const c=new FormData;c.append("file",t);const i=await r.put("/fs/form",c,{headers:{"File-Path":encodeURIComponent(e),"As-Task":o,"Content-Type":"multipart/form-data",Password:n()},onUploadProgress:e=>{if(e.total){const t=e.loaded/e.total*100|0;a("progress",t);const r=(new Date).valueOf(),n=(r-s)/1e3;if(n>1){const t=(e.loaded-l)/n,o=(e.total-e.loaded)/t;a("speed",t),console.log(o),s=r,l=e.loaded}100===t&&a("status","backending")}}});return 200===i.code?void 0:new Error(i.message)},provider:/.*/}],E=e=>{const r=o();return i(h,{w:"$full",spacing:"$1",rounded:"$lg",border:"1px solid $neutral7",alignItems:"start",p:"$2",get _hover(){return{border:`1px solid ${m()}`}},get children(){return[i(v,{css:{wordBreak:"break-all"},get children(){return e.path}}),i(d,{spacing:"$2",get children(){return[i(C,{get colorScheme(){return t[e.status]},get children(){return r(`home.upload.${e.status}`)}}),i(v,{get children(){return[P((()=>D(e.speed))),"/s"]}})]}}),i(x,{w:"$full",trackColor:"$info3",rounded:"$full",get value(){return e.progress},size:"sm",get children(){return i(z,{get color(){return m()},rounded:"$md"})}}),i(v,{color:"$danger10",get children(){return e.msg}})]}})};e("default",(()=>{const e=o(),{pathname:t}=s(),[r,n]=l(!1),[v,C]=l(!1),[P,D]=l(!1),[x,z]=c({uploads:[]});let T,I;const O=async e=>{if(0!==e.length){C(!0);for(const t of e){const e=S(t);z("uploads",(t=>[...t,e]))}for await(const t of async function*(e,t,r){const n=new Set;async function a(){const[e,t]=await Promise.race(n);return n.delete(e),t}for(const o of t){const s=(async()=>await r(o,t))().then((e=>[s,e]));n.add(s),n.size>=e&&(yield await a())}for(;n.size;)yield await a()}(3,e,q))console.log(t)}},B=(e,t,r)=>{z("uploads",(t=>t.path===e),t,r)},U=j.filter((e=>e.provider.test(a.provider))),[G,L]=l(U[0]),q=async e=>{const r=e.webkitRelativePath?e.webkitRelativePath:e.name;B(r,"status","uploading");const n=_(t(),r);try{const t=await G().upload(n,e,((e,t)=>{B(r,e,t)}),P());t?(B(r,"status","error"),B(r,"msg",t.message)):(B(r,"status","success"),B(r,"progress",100))}catch(a){console.error(a),B(r,"status","error"),B(r,"msg",a.message)}};return i(h,{w:"$full",pb:"$2",spacing:"$2",get children(){return i(u,{get when(){return!v()},get fallback(){return[i(d,{spacing:"$2",get children(){return[i(g,{colorScheme:"accent",onClick:()=>{z("uploads",(e=>e.filter((({status:e})=>!["success","error"].includes(e))))),console.log(x.uploads)},get children(){return e("home.upload.clear_done")}}),i(u,{get when(){return x.uploads.every((({status:e})=>["success","error"].includes(e)))},get children(){return i(g,{onClick:()=>{C(!1)},get children(){return e("home.upload.back")}})}})]}}),i(p,{get each(){return x.uploads},children:e=>i(E,e)})]},get children(){return[i(f,{type:"file",multiple:!0,ref(e){"function"==typeof T?T(e):T=e},display:"none",onChange:e=>{O(Array.from(e.target.files??[]))}}),i(f,{type:"file",multiple:!0,webkitdirectory:!0,ref(e){"function"==typeof I?I(e):I=e},display:"none",onChange:e=>{O(Array.from(e.target.files??[]))}}),i(h,{w:"$full",justifyContent:"center",get border(){return`2px dashed ${r()?m():"$neutral8"}`},rounded:"$lg",onDragOver:e=>{e.preventDefault(),n(!0)},onDragLeave:()=>{n(!1)},onDrop:async t=>{t.preventDefault(),t.stopPropagation(),n(!1);const r=[],a=Array.from(t.dataTransfer?.items??[]),o=Array.from(t.dataTransfer?.files??[]);let s=a.length;const l=[];for(let e=0;e<s;e++){const t=a[e].webkitGetAsEntry();t?.isFile?r.push(o[e]):t?.isDirectory&&l.push(t)}for(const e of l){const t=await R(e);r.push(...t)}0===r.length&&y.warning(e("home.upload.no_files_drag")),O(r)},spacing:"$4",h:"$56",get children(){return i(u,{get when(){return!r()},get fallback(){return i(w,{get children(){return e("home.upload.release")}})},get children(){return[i(w,{get children(){return e("home.upload.upload-tips")}}),i(b,{w:"30%",get children(){return i($,{get value(){return G().name},onChange:e=>{L(U.find((t=>t.name===e)))},get options(){return U.map((e=>({label:e.name,value:e.name})))}})}}),i(d,{spacing:"$4",get children(){return[i(k,{compact:!0,size:"xl",get"aria-label"(){return e("home.upload.upload_folder")},colorScheme:"accent",get icon(){return i(A,{})},onClick:()=>{I.click()}}),i(k,{compact:!0,size:"xl",get"aria-label"(){return e("home.upload.upload_files")},get icon(){return i(F,{})},onClick:()=>{T.click()}})]}})]}})}})]}})}})}))}}}));
